<template name="game">
  {{#if invalid}}
    {{> http404}}
  {{else}}

    <h2 class="text-center">{{title game}}</h2>

    {{> game_confirmations game=game}}

    {{#with game}}
      {{#if showBothBoards game}}
      {{> game_meta_data game=game}}
      <br />
      <br />
      {{> game_boards game=game ownBoard=ownBoard attackBoard=attackBoard}}
      {{/if}}

      <br />
      <br />

      {{> game_actions game=game}}
      {{> game_meta_foot game=game}}
    {{/with}}
  {{/if}}
</template>

<template name="game_confirmations">
  {{#if actionRemove}}
    <div class="panel panel-danger">
      <div class="panel-heading">
        Do you really want to remove this game?
      </div>
      <div class="panel-body">
        <p>
          {{#if actionRemoveWillDelete game}}
            Removing this game will result in it being immediately deleted.
            This action is irreversible.
          {{else}}
            Removing this game will prevent it from showing up on your
            dashboard.
            This action is irreversible.
            The game will not be deleted until your opponent also removes the
            game from their dashboard.
            {{#if actionRemoveWillResign game}}
              You will also automatically forfeit the game to your opponent.
            {{/if}}
          {{/if}}
        </p>
        <p>
          <button class="removeGame btn btn-danger">Remove</button>
          <a class="btn btn-default" href="{{urlSelf}}">Cancel</a>
        </p>
      </div>
    </div>
    <p>Do you really want to remove this game?</p>
  {{/if}}

  {{#if actionResign}}
    <div class="panel panel-danger">
      <div class="panel-heading">
        Do you really want to resign?
      </div>
      <div class="panel-body">
        <p>
          If you resign, you will automatically lose the game. Are you sure
          this is what you really want?
        </p>
        <p>
          <button class="resignGame btn btn-danger">Resign</button>
          <a class="btn btn-default" href="{{urlSelf}}">Cancel</a>
        </p>
      </div>
    </div>
  {{/if}}
</template>

<template name="game_meta_data">
  <div class="row text-center game-meta-data">
    <div class="col-sm-1"></div>
    <div class="col-sm-4">
      <h3>Player 1</h3>
      <p>{{ownName game}}</p>
    </div>
    <div class="col-sm-2">
      <h3>Turn</h3>
      <p>{{game.turn_number}}</p>
    </div>
    <div class="col-sm-4">
      <h3>Player 2</h3>
      <p>{{opponentName game}}</p>
    </div>
    <div class="col-sm-1"></div>
  </div>
  {{#if game.current_player}}
  <div class="row text-center game-meta-data">
    <div class="col-sm-12">
      <p>Currently {{turnName game}}'s turn</p>
    </div>
  </div>
  {{/if}}
</template>

<template name="game_boards">
  <div class="row text-center">
    <div class="col-sm-6">
      <strong>Your Board</strong>
      {{> board board=ownBoard.squares game=game own=true}}
      {{> sunk_ships sunk=ownBoard.sunk}}
    </div>
    <div class="col-sm-6">
      <strong>Their Board</strong>
      {{> board board=attackBoard.squares game=game own=false}}
      {{> sunk_ships sunk=attackBoard.sunk}}
    </div>
  </div>
</template>

<template name="sunk_ships">
  Ships sunk:
  <ul class="sunkships">
  {{#if sunk}}
    {{#each sunk}}
      <li>{{this}}</li>
    {{/each}}
  {{else}}
    <li>None yet!</li>
  {{/if}}
  </ul>
</template>

<template name="game_actions">
  {{#if canFire game}}
  <div class="row text-center">
    <div class="col-sm-12">
      <p>
        <input type="text" name="selection" id="selection" disabled="true" size="5"
          value="{{move}}" />
        <button class="btn btn-default fireShot {{fireDisabled}}">Fire!</button>
      </p>
    </div>
  </div>
  {{/if}}
  {{#if canResign game}}
  <div class="row text-center">
    <div class="col-sm-12">
      <p>
        <a class="btn btn-danger" href="{{urlResign game}}">Resign Game</a>
      </p>
    </div>
  </div>
  {{/if}}
  {{#if waiting game}}
  <div class="row text-center">
    <div class="col-sm-12">
      <p>{{game.creator.name}} is waiting for an opponent.</p>
      {{#if canJoin game}}
      <p><button class="joinGame">Join Game!</button></p>
      {{/if}}
    </div>
  </div>
  {{/if}}
  {{#if pending game}}
  <div class="row text-center">
    <div class="col-sm-12">
      {{#if amInviter game}}
        <p>{{game.challenger.name}} hasn't responded to your invitation yet.</p>
      {{/if}}
      {{#if amInvitee game}}
        <p>{{game.creator.name}} has invited you to join this game.</p>
        <p>
          <button class="acceptInvite">Accept Invitation</button>
          <button class="declineInvite">Decline Invitation</button>
        </p>
      {{/if}}
      {{#if notMyGame game}}
        <p>{{game.creator.name}} has invited someone else to join this game.</p>
      {{/if}}
    </div>
  </div>
  {{/if}}
</template>

<template name="game_meta_foot">
  <div class="row text-center">
    <div class="col-sm-12">
      {{#if game.time_finished}}
      <p>
        Game over! The winner is: {{winner game}}!
        {{#if game.resignation}}
          ({{resignedPlayer game}} resigned.)
        {{/if}}
      </p>
      {{/if}}
      <div class="small">
        <p>Game created: {{dateFormat game.created_at}}</p>
        {{#if game.time_started}}
        <p>Game started: {{dateFormat game.time_started}}</p>
        {{/if}}
        {{#if game.time_finished}}
        <p>Game ended: {{dateFormat game.time_finished}}</p>
        {{/if}}
      </div>
    </div>
  </div>
</template>